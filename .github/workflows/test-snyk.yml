name: ðŸ§ª Test Snyk Token

on:
  workflow_dispatch:

jobs:
  test-snyk:
    name: ðŸ” Test Snyk Setup
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ›’ Checkout Repository
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ“¥ Install Dependencies
        run: npm ci --prefer-offline --no-audit

      - name: ðŸ” Test Snyk Token
        run: |
          if [ -z "${{ secrets.SNYK_TOKEN }}" ]; then
            echo "âŒ SNYK_TOKEN secret is not configured"
            echo "Please add your Snyk API token as a repository secret"
            exit 1
          else
            echo "âœ… SNYK_TOKEN secret is configured"
            echo "Token length: ${#SNYK_TOKEN} characters"
          fi
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}

      - name: ðŸ” Test Snyk Scan
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        with:
          args: --version

      - name: ðŸ” Run Actual Snyk Test
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        with:
          args: test --severity-threshold=high

      - name: âœ… Success
        run: |
          echo "## ðŸŽ‰ Snyk Setup Successful!" >> $GITHUB_STEP_SUMMARY
          echo "Your Snyk token is working correctly." >> $GITHUB_STEP_SUMMARY
          echo "You can now delete this test workflow." >> $GITHUB_STEP_SUMMARY
