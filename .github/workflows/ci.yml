name: ðŸš€ Continuous Integration

on:
  push:
    branches: [main, develop, feature/*, hotfix/*]
  pull_request:
    branches: [main, develop]
  workflow_dispatch:

env:
  NODE_VERSION: '18'

jobs:
  # ===========================
  # BASIC VALIDATION
  # ===========================
  basic-checks:
    name: ðŸ” Basic Checks
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ›’ Checkout Repository
        uses: actions/checkout@v4

      - name: âœ… Status Report
        run: |
          echo "## ðŸ” Basic Checks" >> $GITHUB_STEP_SUMMARY
          echo "- **Repository**: ${{ github.repository }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Branch**: ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Trigger**: ${{ github.event_name }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Commit**: ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Basic checks completed successfully"

  # ===========================
  # INSTALL AND TEST
  # ===========================
  test:
    name: ðŸ§ª Test Suite
    runs-on: ubuntu-latest
    needs: basic-checks
    steps:
      - name: ðŸ›’ Checkout Repository
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ðŸ“¥ Install Dependencies
        run: npm ci --prefer-offline --no-audit

      - name: ðŸ” Lint Check
        run: npm run lint

      - name: ðŸ” Type Check
        run: npm run type-check

      - name: ðŸ§ª Run Tests
        run: npm run test:ci

      - name: ðŸ“Š Test Summary
        run: |
          echo "## ðŸ§ª Test Results" >> $GITHUB_STEP_SUMMARY
          echo "âœ… All tests passed successfully" >> $GITHUB_STEP_SUMMARY

  # ===========================
  # BUILD VALIDATION
  # ===========================
  build:
    name: ðŸ—ï¸ Build
    runs-on: ubuntu-latest
    needs: [basic-checks, test]
    steps:
      - name: ðŸ›’ Checkout Repository
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ðŸ“¥ Install Dependencies
        run: npm ci --prefer-offline --no-audit

      - name: ðŸ—ï¸ Build Application
        run: npm run build

      - name: ðŸ“Š Build Summary
        run: |
          echo "## ðŸ—ï¸ Build Results" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Build completed successfully" >> $GITHUB_STEP_SUMMARY

  # ===========================
  # FINAL STATUS
  # ===========================
  status:
    name: âœ… Final Status
    runs-on: ubuntu-latest
    needs: [basic-checks, test, build]
    if: always()
    steps:
      - name: ðŸ“Š Overall Status
        run: |
          echo "## ðŸŽ¯ Pipeline Status" >> $GITHUB_STEP_SUMMARY
          echo "- **Basic Checks**: ${{ needs.basic-checks.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Tests**: ${{ needs.test.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Build**: ${{ needs.build.result }}" >> $GITHUB_STEP_SUMMARY

          if [[ "${{ needs.basic-checks.result }}" == "success" && 
                "${{ needs.test.result }}" == "success" && 
                "${{ needs.build.result }}" == "success" ]]; then
            echo "âœ… **All checks passed!**" >> $GITHUB_STEP_SUMMARY
            exit 0
          else
            echo "âŒ **Some checks failed**" >> $GITHUB_STEP_SUMMARY
            exit 1
          fi
